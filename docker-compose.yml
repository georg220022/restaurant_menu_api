version: '3.3'

services: 
  web:
    container_name: web
    build:
      context: app/
      dockerfile: Dockerfile
    command:
      bash -c "alembic upgrade head && python3 run_server.py"
    restart:
      always
    depends_on:
      - redis_db
    ports:
      - 8000:8000
 
  postgres_db:
    container_name: postgres_db
    image: postgres:15.1-alpine
    restart:
      always
    env_file:
      app/.env
    expose:
      - 5432
    ports:
      - 5432:5432
  
  redis_db:
    container_name: redis_db
    image: redis:latest
    depends_on:
      - postgres_db
    restart: always
    env_file:
      - app/.env
    expose:
      - 6379
 